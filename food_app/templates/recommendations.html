{% extends 'base.html' %}
{% block title %}Advanced Search for {{ selected_food.food_name }}{% endblock %}
{% block content %}
<div class="card shadow-sm p-4">
    <h2 class="mb-4">Recommendations for {{ selected_food.food_name }}</h2>
    <ul class="list-group mt-2">
        {% for rec in recommendations %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>{{ rec.food_name }}</span>
                <div class="rating-slider-container">
                    <input type="range" min="0" max="5" step="0.5" value="0" class="rating-slider" data-food-id="{{ rec.id }}" onchange="submitRating(this)">
                    <span class="rating-value">0</span>
                </div>
            </li>
        {% endfor %}
    </ul>
</div>

<!-- Styling for the slide bar -->
<style>
.rating-slider-container {
    display: flex;
    align-items: center;
    gap: 10px;
}
.rating-slider {
    width: 150px;
    -webkit-appearance: none;
    appearance: none;
    height: 8px;
    border-radius: 5px;
    background: linear-gradient(to right, red 0%, yellow 60%, green 100%);
    outline: none;
}
.rating-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #333;
    cursor: pointer;
}
.rating-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #333;
    cursor: pointer;
}
.rating-value {
    width: 30px;
    text-align: right;
}
</style>

<script>
    // This function submits the rating whenever the slider is changed
function submitRating(slider) {
    const rating = slider.value;
    const foodId = slider.getAttribute('data-food-id');
    const recommendationId = "{{ recommendation_id }}"; // Will be passed from view
    const ratingValueSpan = slider.nextElementSibling;
    ratingValueSpan.textContent = rating;

    // Send rating to backend
    fetch('/submit_rating/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            recommendation_id: recommendationId,
            food_id: foodId,
            rating: rating
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status !== 'success') {
            alert('Failed to submit rating.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error submitting rating.');
    });
}
</script>
{% endblock %}

<!-- --working -->